<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>SWI-Prolog Virtual DOM test</title>
        <style>
           .task { cursor: pointer }
           .task-done { text-decoration: line-through }
           .error { color: red }
           form, ul { margin: 10px 0 }
        </style>
    </head>
    <body>
        <div id="root"></div>
        <script src="/jquery.min.js"></script>
        <script src="/pengine/pengines.js"></script>
        <script src="/patch.js"></script>
        <script src="/events.js"></script>
        <script>
            $.ajax({
                url : '/client.pl',
                dataType: 'text',
                success : function (data) {
                    initPengine(data);
                }
            });
            function initPengine(src) {
                var root = document.getElementById('root');
                window.pengine = new Pengine({
                    destroy: false,
                    src: src,
                    onsuccess: function() {
                        var patches = this.data[0].Diff;
                        if (patches) {
                            console.log(JSON.stringify(patches, null, 2));
                            window.applyPatches(root, patches, false);
                        }                    
                    },
                    onfailure: function() {
                        console.log("Failure");
                    },
                    onerror: function() {
                        console.log("Error: " + this.data);
                    },
                    oncreate: function() {
                        window.pengine.ask('current_diff(Diff)');
                    }
                });
                window.pengine = pengine;
            } 
        </script>
    </body>
</html>
